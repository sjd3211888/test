# DSF代码仓库说明
## 1.代码仓库简介
DSF（Deterministic Scheduler Framework，确定性调度框架）是VBS工程的核心组件之一。
该框架面向智能驾驶应用场景，构建了一套支持SoC内跨进程通信、低延迟、高稳定性的域内通信系统。DSF提供与域间统一的通信接口，简化了系统架构设计与开发维护。
DSF 主要包含以下两个基础组件：
- 共享内存消息队列：用于高效传递结构化数据
- 共享内存消息：实现零拷贝的数据传输机制
## dsf特性
### 1. 高性能设计
  - 通信消息零拷贝：通过共享内存实现消息及消息队列的存储，消除数据在进程间的拷贝和序列化操作，降低通信延迟。
  - 通信队列单读单写的无锁实现：基于单读单写的消息队列模型，采用无锁方式实现高效的并发访问。
  - 预分配内存池：通过内存池机制快速分配和释放事件、队列及消息对象，提升整体性能。
### 2. 高可靠保障
  - 访问安全：使用跨进程信号量与原子变量保护关键数据结构，确保多进程访问时的数据一致性。
  - 异常处理：针对系统各类常见异常设计完善的恢复机制，提升系统健壮性。
  - 可诊断：驱动用户态库提供profiling和调试工具链，便于问题定位与性能分析。
  - 可重入：接口设计和实现考虑线程安全与可重入场景，确保在多线程或中断上下文中稳定运行。
### 3. 可伸缩性设计
  - 灵活的数据队列配置：根据业务场景支持多种通信模式，包括：
    - 配置阻塞/非阻塞通信
    - FIFO等待/消息覆盖（Override）
    - 零拷贝/大buffer零拷贝
  - 共享内存适配能力：数据结构抽象支持底层适配多种内存类型，例如shm、dma_buf等。
  - 跨平台适配：用户态库通过OS抽象层适配不同操作系统与驱动接口，统一的编译脚本支持在多个平台下的一致构建。
## 2.代码目录
dsf源码在haloosspace/vbs/dsf目录下，目录结构如下图所示：
├── clang-format-increment.sh       # 增量代码格式化
├── CMakeLists.txt                  # dsf仓库cmake编译脚本
├── include
│   ├── common                      # 公共头文件
│   ├── dsfdds                      # dds层头文件
│   │   └── dds
│   │       ├── discovery           # 承接服务发现头文件
│   │       ├── domain              # domain头文件
│   │       ├── publisher           # pub侧头文件
│   │       └── subscriber          # sub侧头文件
│   ├── membuf                      # 共享内存消息头文件
│   └── shmmq                       # 共享内存消息队列头文件
├── README.md                       # dsf仓库的readme
└── src
    ├── common                      # dsf内部公有文件
    ├── dsfdds                      # dds层实现集合
    │   ├── discovery               # 承接服务发现的实现
    │   ├── domain                  # domain的实现
    │   ├── publisher               # pub侧的实现
    │   ├── subscriber              # pub侧的实现
    │   ├── transport               # 传输层的实现
    │   └── utils                   # dsf配置转换实现
    ├── membuf                      # 共享内存消息实现
    │   ├── CMakeLists.txt          # 共享内存消息cmake编译脚本
    │   ├── core                    # 共享内存消息分配算法实现
    │   ├── shared                  # 共享内存消息数据结构实现
    │   └── utility                 # 共享内存消息链表维护头文件
    ├── shmmq                       # 共享内存消息队列实现
    └── unimem                      # 驱动的用户态封装实现
